To set up the backend CI/CD pipeline before writing application code, we need three things: the folder structure to hold the configuration, a Dockerfile for containerization, and a GitHub Actions .yml workflow for automated testing and building.
1. Backend Folder Structure

   This structure includes the solution and project folders created earlier, plus the specific locations for Docker and GitHub Actions configuration.

```aiignore
dsh-etl-search-ai-2025/
├── .github/
│   └── workflows/
│       └── backend-ci.yml           # GitHub Actions Workflow
│
├── backend/
│   ├── DshEtlSearch.sln             # Solution file
│   ├── DshEtlSearch.Api/
│   │   ├── DshEtlSearch.Api.csproj
│   │   └── Dockerfile               # Backend Dockerfile
│   ├── DshEtlSearch.Core/
│   │   └── DshEtlSearch.Core.csproj
│   ├── DshEtlSearch.Infrastructure/
│   │   └── DshEtlSearch.Infrastructure.csproj
│   └── DshEtlSearch.Tests/
│       └── DshEtlSearch.Tests.csproj
└── .dockerignore                    # Context exclusion rules
```
2. Dockerfile (backend/DshEtlSearch.Api/Dockerfile)

   This multi-stage Dockerfile restores dependencies, builds the release version, and creates a lightweight runtime image.

```aiignore
# Stage 1: Build
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

# Copy solution and project files first to leverage caching
COPY ["backend/DshEtlSearch.sln", "./"]
COPY ["backend/DshEtlSearch.Api/DshEtlSearch.Api.csproj", "backend/DshEtlSearch.Api/"]
COPY ["backend/DshEtlSearch.Core/DshEtlSearch.Core.csproj", "backend/DshEtlSearch.Core/"]
COPY ["backend/DshEtlSearch.Infrastructure/DshEtlSearch.Infrastructure.csproj", "backend/DshEtlSearch.Infrastructure/"]
COPY ["backend/DshEtlSearch.Tests/DshEtlSearch.Tests.csproj", "backend/DshEtlSearch.Tests/"]

# Restore dependencies
RUN dotnet restore "backend/DshEtlSearch.sln"

# Copy the remaining source code
COPY . .

# Build the application
WORKDIR "/src/backend/DshEtlSearch.Api"
RUN dotnet build "DshEtlSearch.Api.csproj" -c Release -o /app/build

# Publish the application
FROM build AS publish
RUN dotnet publish "DshEtlSearch.Api.csproj" -c Release -o /app/publish /p:UseAppHost=false

# Stage 2: Runtime
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS final
WORKDIR /app
EXPOSE 8080
EXPOSE 8081

COPY --from=publish /app/publish .
ENTRYPOINT ["dotnet", "DshEtlSearch.Api.dll"]
Note: Place a .dockerignore file in the root dsh-etl-search-ai-2025/ folder to prevent copying unnecessary files:

**/.dockerignore
**/.env
**/bin
**/obj
.git
.github
```
3. GitHub Actions Workflow (.github/workflows/backend-ci.yml)

   This workflow triggers on pushes to the main branch or pull requests. It restores dependencies, builds the solution, runs unit tests, and verifies the Docker build.

```aiignore
name: Backend CI

on:
  push:
    branches: [ "main" ]
    paths:
      - 'backend/**'
  pull_request:
    branches: [ "main" ]
    paths:
      - 'backend/**'

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: ./backend

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'

    - name: Restore dependencies
      run: dotnet restore DshEtlSearch.sln

    - name: Build Solution
      run: dotnet build DshEtlSearch.sln --no-restore --configuration Release

    - name: Run Unit Tests
      run: dotnet test DshEtlSearch.sln --no-build --configuration Release --verbosity normal

  docker-build:
    runs-on: ubuntu-latest
    needs: build-and-test  # Only run if tests pass
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Build Docker Image
      # Run docker build from root to access all backend subfolders
      run: |
        docker build -f backend/DshEtlSearch.Api/Dockerfile -t dsh-etl-backend:latest .
```

Next Steps
1. Commit: Add these files to your repository.
2. Verify: Push to GitHub. The "Backend CI" action should run automatically.
3. Result: You will see green checkmarks for "build-and-test" and "docker-build," confirming your environment is ready for the Phase 1 implementation.


